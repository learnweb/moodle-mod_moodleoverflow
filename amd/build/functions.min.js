define(["jquery","core/ajax","core/templates","core/notification"],function(a,b,c,d){var e={recordvote:function(e,f,g,h,i,j){var k=b.call([{methodname:"mod_moodleoverflow_record_vote",args:{discussionid:e,postid:f,ratingid:g,userid:h,sesskey:j}}]);return k[0].done(function(b){var e;e={userupvoted:!1,userdownvoted:!0,canchange:!0,votes:b.postrating,removeupvotelink:i+"&r=20",upvotelink:i+"&r=2",removedownvotelink:i+"&r=10",downvotelink:i+"&r=1"},2===g?(e.userupvoted=!0,e.userdownvoted=!1):10!==g&&20!==g||(e.userdownvoted=!1,e.userupvoted=!1),c.render("mod_moodleoverflow/postvoting",e).then(function(b,d){c.replaceNodeContents(a('.votes a[href$="rp='+f+'"]').parent(),b,d)}).fail(d.example),c.replaceNode(a(".user-details,.author").find('a[href*="id='+h+'"]').siblings("span"),"<span>"+b.raterreputation+"</span>",""),h!==b.ownerid&&c.replaceNode(a(".user-details,.author").find('a[href*="id='+b.ownerid+'"]').siblings("span"),"<span>"+b.ownerreputation+"</span>","");var j=a("#p"+f).parent(),k=j.attr("class"),l=new Date(j.find(".user-action-time").text());if("main"!==j.attr("role")&&j.children("div").first().attr("class").indexOf("status")<0&&"intend"!==k){var l=new Date(j.find(".user-action-time").text());if(1===g||20===g){var m,n,o=!1;j.nextAll().each(function(){if(m=a(this),n=parseInt(a(".votes p",this).text()),n<b.postrating||n===b.postrating&&l<new Date(m.find(".user-action-time").text()))return o=!0,!1}),o?(j.remove(),j.insertBefore(m)):m&&(j.remove(),j.insertAfter(m))}else{var p,n,o=!1;j.prevUntil(":not(.tmargin)").each(function(){if(p=a(this),n=parseInt(a(".votes p",this).text()),n>b.postrating||n===b.postrating&&l>new Date(p.find(".user-action-time").text()))return o=!0,!1}),o?(j.remove(),j.insertAfter(p)):p&&(j.remove(),j.insertBefore(p))}}a(window).scrollTop(a("#p"+f).offset().top)}).fail(d.exception),k}};return e});