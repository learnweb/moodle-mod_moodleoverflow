{"version":3,"file":"reviewing.min.js","sources":["../src/reviewing.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Implements reviewing functionality\n *\n * @module     mod_moodleoverflow/reviewing\n * @copyright  2022 Justus Dieckmann WWU\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport Ajax from 'core/ajax';\nimport Prefetch from 'core/prefetch';\nimport Templates from 'core/templates';\nimport {get_string as getString} from 'core/str';\n\n/**\n * Init function.\n */\nexport function init() {\n    Prefetch.prefetchTemplates(['mod_moodleoverflow/reject_post_form', 'mod_moodleoverflow/review_buttons']);\n    Prefetch.prefetchStrings('mod_moodleoverflow',\n        ['post_was_approved', 'jump_to_next_post_needing_review', 'there_are_no_posts_needing_review', 'post_was_rejected']);\n\n    const root = document.getElementById('moodleoverflow-posts');\n    root.onclick = async(e) => {\n        const action = e.target.getAttribute('data-moodleoverflow-action');\n\n        if (!action) {\n            return;\n        }\n\n        const post = e.target.closest('*[data-moodleoverflow-postid]');\n        const reviewRow = e.target.closest('.reviewrow');\n        const postID = post.getAttribute('data-moodleoverflow-postid');\n\n        if (action === 'approve') {\n            reviewRow.innerHTML = '.';\n            const nextPostURL = await Ajax.call([{\n                methodname: 'mod_moodleoverflow_review_approve_post',\n                args: {\n                    postid: postID,\n                }\n            }])[0];\n\n            let message = await getString('post_was_approved', 'mod_moodleoverflow') + ' ';\n            if (nextPostURL) {\n                message += `<a href=\"${nextPostURL}\">`\n                    + await getString('jump_to_next_post_needing_review', 'mod_moodleoverflow')\n                    + \"</a>\";\n            } else {\n                message += await getString('there_are_no_posts_needing_review', 'mod_moodleoverflow');\n            }\n            reviewRow.innerHTML = message;\n            post.classList.remove(\"pendingreview\");\n        } else if (action === 'reject') {\n            reviewRow.innerHTML = '.';\n            reviewRow.innerHTML = await Templates.render('mod_moodleoverflow/reject_post_form', {});\n        } else if (action === 'reject-submit') {\n            const rejectMessage = post.querySelector('textarea.reject-reason').value.toString().trim();\n            reviewRow.innerHTML = '.';\n            const args = {\n                postid: postID,\n                reason: rejectMessage ? rejectMessage : null\n            };\n            const nextPostURL = await Ajax.call([{\n                methodname: 'mod_moodleoverflow_review_reject_post',\n                args: args\n            }])[0];\n\n            let message = await getString('post_was_rejected', 'mod_moodleoverflow') + ' ';\n            if (nextPostURL) {\n                message += `<a href=\"${nextPostURL}\">`\n                    + await getString('jump_to_next_post_needing_review', 'mod_moodleoverflow')\n                    + \"</a>\";\n            } else {\n                message += await getString('there_are_no_posts_needing_review', 'mod_moodleoverflow');\n            }\n            reviewRow.innerHTML = message;\n        } else if (action === 'reject-cancel') {\n            reviewRow.innerHTML = '.';\n            reviewRow.innerHTML = await Templates.render('mod_moodleoverflow/review_buttons', {});\n        }\n    };\n}"],"names":["prefetchTemplates","prefetchStrings","document","getElementById","onclick","e","action","target","getAttribute","post","closest","reviewRow","postID","innerHTML","Ajax","call","methodname","args","postid","nextPostURL","message","classList","remove","Templates","render","rejectMessage","querySelector","value","toString","trim","reason"],"mappings":"8iBA+BaA,kBAAkB,CAAC,sCAAuC,wDAC1DC,gBAAgB,qBACrB,CAAC,oBAAqB,mCAAoC,oCAAqC,sBAEtFC,SAASC,eAAe,wBAChCC,qCAAU,iBAAMC,yMACXC,OAASD,EAAEE,OAAOC,aAAa,gGAM/BC,KAAOJ,EAAEE,OAAOG,QAAQ,iCACxBC,UAAYN,EAAEE,OAAOG,QAAQ,cAC7BE,OAASH,KAAKD,aAAa,8BAElB,YAAXF,sCACAK,UAAUE,UAAY,qBACIC,cAAKC,KAAK,CAAC,CACjCC,WAAY,yCACZC,KAAM,CACFC,OAAQN,WAEZ,kBALEO,4CAOc,mBAAU,oBAAqB,2DAA/CC,oBAAuE,KACvED,uDACAC,uCAAuBD,oCACX,mBAAU,mCAAoC,4FAD1DC,iCAEM,yDAENA,0BAAiB,mBAAU,oCAAqC,8BAAhEA,2CAEJT,UAAUE,UAAYO,QACtBX,KAAKY,UAAUC,OAAO,mDACJ,WAAXhB,sCACPK,UAAUE,UAAY,qBACMU,mBAAUC,OAAO,sCAAuC,YAApFb,UAAUE,0DACQ,kBAAXP,sCACDmB,cAAgBhB,KAAKiB,cAAc,0BAA0BC,MAAMC,WAAWC,OACpFlB,UAAUE,UAAY,IAChBI,KAAO,CACTC,OAAQN,OACRkB,OAAQL,eAAgC,uBAElBX,cAAKC,KAAK,CAAC,CACjCC,WAAY,wCACZC,KAAMA,QACN,kBAHEE,6CAKc,mBAAU,oBAAqB,2DAA/CC,qBAAuE,KACvED,wDACAC,wCAAuBD,qCACX,mBAAU,mCAAoC,6FAD1DC,mCAEM,0DAENA,2BAAiB,mBAAU,oCAAqC,8BAAhEA,6CAEJT,UAAUE,UAAYO,2CACJ,kBAAXd,sCACPK,UAAUE,UAAY,qBACMU,mBAAUC,OAAO,oCAAqC,YAAlFb,UAAUE"}